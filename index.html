<!DOCTYPE html>
<html>
  <head>

    <!--    Place the script for aframe here     -->
    <script src="aframe.min.js"></script>
    <!-- Link Clicking -->
    <script src="aframe-href-component.min.js"></script>
    <!--     Place the script for aframe extras here -->
    <script src="aframe-extras.js"></script>
    <!--     Place the script for the environment component here -->
    <script src="aframe-environment-component.min.js"></script>
    <!--    Event Waypoint Script -->
    <script src="aframe-particle-system-component.min.js"></script>  
    <script src="aframe-event-set-component.min.js"></script>

    <!-- ANIMATE PNG-->
    <script src="animatepng.js"></script>
      <script src="animatepng2.js"></script>
      <script src="animatepng3.js"></script>

<!-- SPEECH SYNTHESIS -->
     <script>
function speak(text) {
  var synth = window.speechSynthesis;
  var chunks = text.match(/[^\.!\?]+[\.!\?]+/g); // split the text into full sentences
  var currentChunk = 0;
  
  if (!synth.speaking) { // check if the speech has ended before starting a new one
    var utterance = new SpeechSynthesisUtterance(chunks[currentChunk]);

    utterance.onend = function() {
      currentChunk++;
      if (currentChunk < chunks.length) {
        utterance.text = chunks[currentChunk];
        synth.speak(utterance);
      }
    };

    synth.speak(utterance);
  }
}
</script>	  
    
    <!---VERTICAL PITCH touch controls--->
    <script>
    
    AFRAME.components["look-controls"].Component.prototype.onTouchMove = function (t) {
                        var PI_2 = Math.PI/2,
                        e,
                        o = this.el.sceneEl.canvas,
                        i = this.yawObject,
                        j = this.pitchObject;
                        this.touchStarted && this.data.touchEnabled && (e = 2 * Math.PI * (t.touches[0].pageX - this.touchStart.x) / o.clientWidth, f = 2 * Math.PI * (t.touches[0].pageY - this.touchStart.y) / o.clientHeight, j.rotation.x += .3 * f, i.rotation.y += .5 * e, j.rotation.x = Math.max(-PI_2, Math.min(PI_2, j.rotation.x)), this.touchStart = {
                                x: t.touches[0].pageX,
                                y: t.touches[0].pageY
                            })
                        }

    
    </script>
    
    
    <!--IOS VIDEO COMPATABILITY-->
    <script>
        AFRAME.registerComponent('play-on-click', {
          init: function () {
            this.onClick = this.onClick.bind(this);
          },
          play: function () {
            window.addEventListener('click', this.onClick);
          },
          pause: function () {
            window.removeEventListener('click', this.onClick);
          },
          onClick: function (evt) {
            var videoEl = this.el.getAttribute('material').src;
            if (!videoEl) { return; }
            this.el.object3D.visible = true;
            videoEl.play();
          }
        });
    </script> 
    
    
    <!--- GOTO SCRIPT --->
    <script>
      AFRAME.registerSystem("goto", {
        init: function() {
          // global - shared between all goto components
          this.isMoving = false;
        }
      });

      AFRAME.registerComponent("goto", {
        init: function() {
          let rig = document.querySelector('#pov')
          rig.addEventListener('animationcomplete', e=> {
            this.system.isMoving = false
          })
          this.el.addEventListener("click", e => {
            if (this.system.isMoving) return;
            let targetPos = this.el.getAttribute("position")
            let rigPos = rig.getAttribute("position")
            this.system.isMoving = true
            
            
            rig.setAttribute("animation", {
              "from": rigPos,
              "to": AFRAME.utils.coordinates.stringify({x: targetPos.x, y: rigPos.y, z: targetPos.z}),
              "dur": targetPos.distanceTo(rigPos) * 200
            })
            rig.emit('go')
          });
        }
      });
    </script>
    
    
    
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!---LINK TRAVERSAL-->
    <script>
    AFRAME.registerComponent('link-url', {
          schema: {url: {default: ''},},

          init: function () {
            var url = this.data.url;
            this.el.addEventListener('click', function () {
              window.location.href = url;
            });
          }
        });
    </script>

  </head>

   <body>
       
<script>
// create the splash screen element
const splashScreen = document.createElement('div');
splashScreen.style.position = 'fixed';
splashScreen.style.top = '0';
splashScreen.style.left = '0';
splashScreen.style.width = '100%';
splashScreen.style.height = '100%';
splashScreen.style.backgroundColor = 'rgba(0,0,0,0.7)';
splashScreen.style.zIndex = '9999';

// add the instructions to the splash screen
const instructions = document.createElement('div');
instructions.style.color = '#fff';
instructions.style.textAlign = 'center';
instructions.style.marginTop = '50vh';
instructions.style.transform = 'translateY(-50%)';
instructions.style.fontSize = '24px';
instructions.style.fontWeight = 'bold';

const line1 = document.createElement('p');
line1.innerText = 'This is an interactive gallery application';
instructions.appendChild(line1);

const line2 = document.createElement('p');
line2.innerText = '...';
instructions.appendChild(line2);

const line3 = document.createElement('p');
line3.innerText = 'click anywhere to begin';
instructions.appendChild(line3);

splashScreen.appendChild(instructions);

// add the splash screen to the body
document.body.appendChild(splashScreen);

// create the audio element
const audioElement = new Audio('gallerysound2.mp3');
audioElement.loop = true;

// add an event listener to the splash screen to start the audio and remove the splash screen on click
splashScreen.addEventListener('click', () => {
  audioElement.play();
  splashScreen.remove();
});
</script>
       
       
    <a-scene
             >
      <!-- Asset Management System-->

      <a-assets>
        <a-asset-item
          id="gallery"
          src="artlabsectionRoom1.gltf"
        ></a-asset-item> 
        <video muted id="snail" src="Snail1.mp4" webkit-playsinline autoplay loop="true">
        </video>

        <a-asset-item
          id="sculpture1"
          src="Sculpture1.gltf"
        ></a-asset-item>
          
        <a-asset-item
          id="sculpture2"
          src="Sculpture2.gltf"
        ></a-asset-item>
          
        <a-asset-item
          id="computer"
          src="computer.gltf"
        ></a-asset-item>

      </a-assets>
    
      <!--CAMERA-->

<a-entity 
          rotation="0 0 0">
     <a-entity position="0 0 0" 
               rotation="0 0 0" 
               id="pov" 
               animation="property: 
                          position; 
                          startEvents: go">
  <a-camera look-controls wasd-controls-enabled="true">
    <a-entity cursor="rayOrigin: mouse" 
              ></a-entity>
  </a-camera>
</a-entity>
</a-entity>
    
        
        

        
         <a-plane class="clickable"
                 material="opacity: 0.0;
                           transparent: true"
                 color="black" 
                 height="8.2" 
                 width="10.57" 
                 scale="1 1 1"      
                 rotation="-90 90 0" 
                 position="-0.12063 0.02 1.90408"></a-plane>

        

      <!-- Scene -->
        
        <a-sound src="gallerysound2.mp3" 
                     autoplay="true" 
                     loop="true"
                     position="-2.5 .01 -4"
                    preload="auto"
                 
                     >           
        </a-sound>
        
        
        
      <a-entity gltf-model="artlabsectionRoom1-01.gltf" 
                shadow="cast: true; receive: true" 
                position="-6.07817 0 14.77275" 
                rotation="0 -90 0"
                >
        </a-entity>
        <a-image 
                 position="-1.5 2.88792 -3.45706" 
                 scale="5 5 5" 
                 rotation="0 0 0"
                 animate-png3
                 ></a-image>

        
        
                <a-image src="instructions1.png"
                 material="side: single"
                 position="0 1.40 -1.5"
                 scale="0.5 0.5 0.5" 
                 rotation="0 0 0"
                 animation="property: position;
                            to: 0 1.5 -1.5;
                            easing: easeInOutQuad;
                            dur: 1000;
                            loop: true;
                            dir: alternate"
                 
                 onclick="speak('click the ground to move the camera. Have fun!')"
                 ></a-image>
        
        <a-text
                value="bygones, bygones is an exhibition set in a virtual plane mirroring the physicality of the space it is designed for. By virtue of its medium, this exhibition aims to interrogate the nature of the digital archive as an assumed permanent vault that is immune to decay."
                color="black"
                position="2.5 2.8 -3.45706"
                anchor="center"
                scale=".4 .4 .3"
                align=  "left"
                rotation="0 0 0"
                geometry="primitive: plane; 
                          width: 5.2; 
                          height: 1.8;"
                material="color: white"
                onclick="speak('bygones, bygones is an exhibition set in a virtual plane mirroring the physicality of the space it is designed for. By virtue of its medium, this exhibition aims to interrogate the nature of the digital archive as an assumed permanent vault that is immune to decay.')"
                >
        </a-text>
        <a-text
                value="The unfortunate reality of back up drives, flash storage, and web based mediums is that they are too in constant flux with the environment around them. While canvas and paper falls ill to decay of organic nature, the digital archive lays vulnerable to bit rot, link death, memory errors, and data leakage."
                color="black"
                position="2.5 2 -3.45706"
                anchor="center"
                scale=".4 .4 .3"
                align=  "left"
                rotation="0 0 0"
                geometry="primitive: plane; 
                          width: 5.2; 
                          height: 1.8;"
                material="color: white"
                onclick="speak('The unfortunate reality of back up drives, flash storage, and web based mediums is that they are too in constant flux with the environment around them. While canvas and paper falls ill to decay of organic nature, the digital archive lays vulnerable to bit rot, link death, memory errors, and data leakage.')"
                >
        </a-text>
        <a-text
                value="The cultural attitudes of virtual storage exists without this acceptance of decay - rather, the digital archive is heightened to a status of immortality, allowing for peace of mind for archiving memories and experiences in the file cabinet of cloud storage. Bygones, bygones, questions this digital impermanence in the era of lax attitudes to the personal archival processes in retrospect to nostalgia."
                color="black"
                position="2.5 1 -3.45706"
                anchor="center"
                scale=".4 .4 .3"
                align=  "left"
                rotation="0 0 0"
                geometry="primitive: plane; 
                          width: 5.2; 
                          height: 2.8;"
                material="color: white"
                onclick="speak('The cultural attitudes of virtual storage exists without this acceptance of decay - rather, the digital archive is heightened to a status of immortality, allowing for peace of mind for archiving memories and experiences in the file cabinet of cloud storage. Bygones, bygones, questions this digital impermanence in the era of lax attitudes to the personal archival processes in retrospect to nostalgia.')">
        </a-text>
        
        
		<a-entity gltf-model="#sculpture1"   
                  position="2.54153 1.4 -1.03564"
                  scale="0.2 0.4 0.2" 
                  rotation="0 90 0"   
                  >
		</a-entity>
        <a-box
               position="2.54153 0.5 -1.03564"
               scale="0.8 1.67 0.8"
               color="white">
        </a-box>

    
        
        
        <a-entity gltf-model="#sculpture2"
                  position="2.54153 1.172 1.8"
                  scale="0.2 0.4 0.2" 
                  rotation="0 90 0">
		</a-entity>
        <a-box
               position="2.54153 0.5 1.8"
               scale="0.8 1.2 0.8"
               color="white">
        </a-box>
		


        
 <a-entity position="1 1 4"
                  animation="property: position;
                            to: 1 1.2 4;
                            easing: easeInOutQuad;
                            dur: 800;
                            loop: true;
                            dir: alternate">
        <a-entity gltf-model="#computer"
                  shadow="cast: true;
                          recieve: true;"
                  scale="1 1 1"
                  animation="property: rotation;
                            easing: linear;
                             to: 0 360 0;
                            dur: 8000;
                            loop: true;
                            dir: "
                  
                >
            
        </a-entity>
        </a-entity>

        
        
	<a-image src="bygonesbygones.png"
                 position= "-1.743 2 7.277"
                 rotation= "0 180 0"
                scale= "3 3 3"
                 >
    </a-image> 
	
	     <a-entity >
            <a-entity>
                <a-video playsinline 
                         webkitplaysinline
                         src="#snail" 
                         width="3.9" 
                         height="2.87"
                         rotation="0 90 0" 
                         position="-4.371 2 0.197"
                         play-on-click="true"
                         ></a-video>

            </a-entity>
        </a-entity>
      <a-plane
                rotation="0 90 0" 
                         position="-4.36 0.85 -1."
                color="white"
                scale="0.5 0.5"
                geometry="primitive: plane; width: 2.5; height: 0.7;"
                align="left"
                anchor="center"
                text="value: PHYTOSANITARY - REQUIREMENTS TO PREVENT THE INTRODUCTION OR SPREAD 

                       video mp4
                       october 27 2021;
                      color: black;">
        
        </a-plane>  
		
		
      <a-entity>
          <a-plane        
               position="-4.61697 1.885 6.64436" 
                rotation="0 90 0"  
               animate-png>
                   </a-plane>
      </a-entity>
      

      
       <a-sky
               src="bsod.png"
               animate-png2></a-sky>
      
      
      
    <!--LINKS-->
	<a-text href="hallway.html" 
        position="-4.48039 0.81 6.642" 
        rotation="0 90 0" 
        color="blue"  
        scale=".5 .5 .5" 
        value="Click to Exit Room 468"
        geometry="primitive: plane; width: 2.3; height: 0.5;"
        material="color: #b7beff;"
        align=  "center"
        event-set__down="_event: mousedown; color: #ADD8E6"
            ></a-text>


        
        
          <script>
  var canClick = true; // Set initial click state to true
  var cooldownTime = 300; // Set cooldown time in milliseconds
  var isMouseDown = false; // Set initial mouse state to false
  var mouseUpEvent = new Event('mouseup'); // Create mouseup event

  document.querySelectorAll('.clickable').forEach(function(el) {
    el.addEventListener('mousedown', function () {
      isMouseDown = true; // Set mouse state to true when clicked down
    });

    el.addEventListener('mouseup', function (event) {
      if (isMouseDown && canClick) {
        var intersection = event.detail.intersection;
        var distance = intersection.distance;
        // Minimize accidental clicks by checking if the click was within a reasonable distance from the camera
        if (distance < 10) {
          var newPosition = intersection.point;
          newPosition.y = 1.6; // Adjust the camera height to your liking
          document.querySelector('a-camera').setAttribute('animation', 'property: position; to: ' + newPosition.x + ' ' + newPosition.y + ' ' + newPosition.z + '; dur: 500');

          canClick = false; // Set click state to false
          setTimeout(function () {
            canClick = true; // Reset click state to true after cooldown
          }, cooldownTime);
        }
      }
      isMouseDown = false; // Reset mouse state to false on click up
    });

    el.addEventListener('mouseleave', function () {
      if (isMouseDown) {
        el.dispatchEvent(mouseUpEvent); // Trigger mouseup event if mouse leaves clickable area while still clicked down
      }
      isMouseDown = false; // Reset mouse state to false on mouse leave
    });
  });
  
  document.querySelectorAll('a-text').forEach(function(el) {
    el.addEventListener('click', function () {
      var href = this.getAttribute('href');
      if (href && href !== 'null') {
        window.location.href = href;
        canClick = false; // Set click state to false
        setTimeout(function () {
          canClick = true; // Reset click state to true after cooldown
        }, cooldownTime);
      }
    });
  });
</script>
         
        
        <!-- Ambient Light -->
        <a-entity light="type: ambient;
                         color: #BBB;
                         intensity: 0.2">
        </a-entity>
        
        <a-entity light="type: point;
                         color: #BBB;
                         intensity: 1;"
                  position="4 2 2"
                  rotation="0 90 0">
        </a-entity>
        <a-entity light="type: point;
                         color: #BBB;
                         intensity: 0.5;"
                  position="-2 3 2"
                  rotation="0 90 0">
        </a-entity>


    </a-scene>          
  </body>
</html>
